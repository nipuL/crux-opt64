# Description: HTTP server and mail proxy
# URL: http://nginx.net
# Maintainer: Lucas Hazel, lucas at die dot net dot au
# Depends on: zlib, libpcre, openssl

name=nginx
version=0.6.31
release=1
source=(http://www.nginx.eu/download/sources/$name-$version.tar.gz $name.rc)

build() {
	cd $name-$version
	./configure --prefix=/etc/$name \
		--conf-path=/etc/$name/$name.conf \
		--pid-path=/var/run/$name.pid \
		--lock-path=/var/lock/$name.lock \
		--error-log-path=/var/log/$name/error.log \
		--http-log-path=/var/log/$name/access.log \
		--user=www \
		--group=www \
		--http-client-body-temp-path=/var/tmp/client_body_temp \
		--http-proxy-temp-path=/var/tmp/proxy_temp \
		--http-fastcgi-temp-path=/var/tmp/fastcgi_temp \
		--with-http_ssl_module \
		--with-mail \
		--with-mail_ssl_module
		
	make
	
	# make install is retarded, let's do it by hand
	install -o root -g root -m 0755 -d $PKG/{etc/{rc.d,$name/html},usr/sbin,var/log/$name}
	
	install -o root -g root -m 0755 objs/$name $PKG/usr/sbin/$name
	
	for f in `ls conf`
	do
		install -o root -g root -m 0644 conf/$f $PKG/etc/$name/$f
	done
	
	for f in `ls html`
	do
		install -o root -g root -m 0644 html/$f $PKG/etc/$name/html/$f
	done
	
	install -o root -g root -m 0755 $SRC/$name.rc $PKG/etc/rc.d/$name
}
