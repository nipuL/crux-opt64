# Description:
# URL:
# Maintainer:
# Packager:
# Depends on: git

name=cgit
version=0.5
release=1
source=()

build() {
	cd $PKGMK_SOURCE_DIR
	
	if [ -d $name ]; then
		(cd $name; git pull)
	else
		git clone git://hjemli.net/pub/git/$name
	fi
	
	if [ ! -d git ]; then
		git clone git://git.kernel.org/pub/scm/git/git.git
	fi
	cp -r $name $SRC/
	cp -r git $SRC/$name/
	
	cd $SRC/$name
	git checkout v$version
	
	sed -i "s|/var/www/htdocs|$PKG&|" Makefile
	sed -i 's|S_ISDIRLNK|S_ISGITLINK|g' html.c
	sed -i 's|S_ISDIRLNK|S_ISGITLINK|g' ui-diff.c
	sed -i 's|S_ISDIRLNK|S_ISGITLINK|g' ui-tree.c
	
	make
	make install
	
	install -D cgitrc $PKG/etc/cgitrc
}